<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ××•×§×“ | ×¤×× ×œ ×× ×”×œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #f1f5f9; }
        .stat-card { @apply bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm text-center transition-transform hover:scale-105; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="bg-slate-900 text-white p-6 sticky top-0 z-50 shadow-xl flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 px-3 py-1 rounded-full font-black text-[10px] tracking-widest">ADMIN PANEL</div>
            <h1 class="text-xl font-black italic">× ×™×”×•×œ ×©×™×‘×•×¦×™ ××•×§×“</h1>
        </div>
        <div class="flex flex-wrap justify-center gap-3">
            <a href="report.html" class="px-4 py-2 bg-emerald-600 rounded-xl text-xs font-bold shadow-lg hover:bg-emerald-700 transition-all flex items-center gap-2">ğŸ“‹ ×”×¤×§ ×“×•"×— ×©×‘×•×¢×™</a>
            <a href="index.html" class="px-4 py-2 bg-slate-800 rounded-xl text-xs font-bold hover:bg-slate-700 transition-all">ğŸ  ××ª×¨ ××•×§×“× ×™×</a>
            <button onclick="loadAdminData()" class="px-4 py-2 bg-blue-600 rounded-xl text-xs font-bold shadow-lg">ğŸ”„ ×¨×¢× ×Ÿ</button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6 space-y-8 text-right">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="stat-card border-b-4 border-blue-500">
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest">×‘×§×©×•×ª ×××ª×™× ×•×ª</div>
                <div id="pendingCount" class="text-4xl font-black text-slate-800 mt-2">0</div>
            </div>
            <div class="stat-card border-b-4 border-emerald-500">
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest">×©×™×‘×•×¦×™× ×××•×©×¨×™×</div>
                <div id="approvedCount" class="text-4xl font-black text-slate-800 mt-2">0</div>
            </div>
            <div class="stat-card border-b-4 border-indigo-500">
                <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest">××•×§×“× ×™× ×¤×¢×™×œ×™×</div>
                <div id="activeUsers" class="text-4xl font-black text-slate-800 mt-2">0</div>
            </div>
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b bg-slate-50/50 flex justify-between items-center">
                <h2 class="text-xl font-black text-slate-800 italic">×‘×§×©×•×ª ×©×™×‘×•×¥ ×œ××™×©×•×¨</h2>
                <div class="flex gap-2">
                    <span class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></span>
                    <span class="text-[10px] font-bold text-slate-400 uppercase">×–××Ÿ ×××ª</span>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-right">
                    <thead>
                        <tr class="text-[11px] font-black text-slate-400 uppercase bg-slate-50 border-b">
                            <th class="p-5">×ª××¨×™×š</th>
                            <th class="p-5">××©××¨×ª</th>
                            <th class="p-5">××•×§×“×Ÿ</th>
                            <th class="p-5">×˜×œ×¤×•×Ÿ</th>
                            <th class="p-5 text-center">×¡×˜×˜×•×¡/×¤×¢×•×œ×”</th>
                        </tr>
                    </thead>
                    <tbody id="requestTable" class="text-sm font-bold text-slate-700">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 px-8 py-4 rounded-2xl text-white font-black shadow-2xl opacity-0 transition-all pointer-events-none z-[100]"></div>

    <script src="config.js"></script>
    <script>
        async function loadAdminData() {
            const table = document.getElementById('requestTable');
            table.innerHTML = '<tr><td colspan="5" class="p-10 text-center opacity-30">×˜×•×¢×Ÿ × ×ª×•× ×™×...</td></tr>';
            
            try {
                const res = await fetch(CONFIG.SCRIPT_URL);
                const data = await res.json();
                
                // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×”
                const pending = data.requests.filter(r => r.×¡×˜×˜×•×¡ === '×××ª×™×Ÿ');
                const approved = data.schedule.length;
                const users = [...new Set(data.requests.map(r => r.×©×_××•×§×“×Ÿ))].length;

                document.getElementById('pendingCount').innerText = pending.length;
                document.getElementById('approvedCount').innerText = approved;
                document.getElementById('activeUsers').innerText = users;

                // ×¨×™× ×“×•×¨ ×˜×‘×œ×”
                if (pending.length === 0) {
                    table.innerHTML = '<tr><td colspan="5" class="p-20 text-center text-slate-300 font-bold">××™×Ÿ ×‘×§×©×•×ª ×—×“×©×•×ª ×›×¨×’×¢</td></tr>';
                    return;
                }

                table.innerHTML = pending.map(r => `
                    <tr class="border-b hover:bg-slate-50 transition-colors">
                        <td class="p-5">${r.×ª××¨×™×š}</td>
                        <td class="p-5 font-black text-blue-600">${r.×¡×•×’_××©××¨×ª}</td>
                        <td class="p-5 text-slate-900">${r.×©×_××•×§×“×Ÿ}</td>
                        <td class="p-5 text-slate-400">${r.×˜×œ×¤×•×Ÿ}</td>
                        <td class="p-5 text-center">
                            <button onclick="approve('${r.×ª××¨×™×š}', '${r.×¡×•×’_××©××¨×ª}', '${r.×©×_××•×§×“×Ÿ}', '${r.×˜×œ×¤×•×Ÿ}')" 
                                class="bg-emerald-500 text-white px-5 py-2 rounded-xl text-xs font-black shadow-md hover:bg-emerald-600 transition-all active:scale-90">
                                ××©×¨ ×©×™×‘×•×¥ âœ…
                            </button>
                        </td>
                    </tr>
                `).join('');

            } catch (e) {
                table.innerHTML = '<tr><td colspan="5" class="p-10 text-center text-red-500">×©×’×™××” ×‘×˜×¢×™× ×”. ×‘×“×•×§ ×—×™×‘×•×¨ ×œ×©×¨×ª.</td></tr>';
            }
        }

        async function approve(date, shift, name, phone) {
            showToast("××¢×‘×“ ××™×©×•×¨...", "#3b82f6");
            try {
                await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: 'approve', date, shiftId: shift, name, phone })
                });
                showToast("×”×©×™×‘×•×¥ ××•×©×¨ ×•× ×•×¡×£ ×œ×œ×•×—!", "#10b981");
                setTimeout(loadAdminData, 1000);
            } catch (e) {
                showToast("×©×’×™××” ×‘×ª×§×©×•×¨×ª", "#ef4444");
            }
        }

        function showToast(m, c) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.backgroundColor = c;
            t.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => t.classList.replace('opacity-100', 'opacity-0'), 3000);
        }

        loadAdminData();
    </script>
</body>
</html>
