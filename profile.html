<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>专 砖 | 拽  砖专</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 font-['Assistant'] pb-20">
    <header class="bg-white border-b-2 border-slate-200 p-4 sticky top-0 z-50 flex justify-between items-center text-right">
        <div class="flex items-center gap-4">
            <img src="logo.png" class="h-12">
            <h1 class="text-xl font-black">专 砖 砖</h1>
        </div>
        <a href="index.html" class="p-3 bg-slate-100 rounded-full text-blue-600"> 专</a>
    </header>

    <main class="max-w-2xl mx-auto p-6 space-y-6 text-right">
        <section class="bg-white p-6 rounded-3xl border shadow-sm">
            <h2 class="text-xl font-black mb-4 border-b pb-2 text-blue-800">注 驻专 砖</h2>
            <div class="space-y-4">
                <input id="up-name" type="text" placeholder="砖 " class="w-full p-3 rounded-xl border bg-slate-50 font-bold outline-none">
                <input id="up-phone" type="tel" placeholder="驻" class="w-full p-3 rounded-xl border bg-slate-50 font-bold outline-none">
                <button onclick="updateDetails()" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md">砖专 砖</button>
            </div>
        </section>

        <section class="bg-white p-6 rounded-3xl border shadow-sm">
            <h2 class="text-xl font-black mb-4 border-b pb-2 text-blue-800">砖专转 砖 (砖专转)</h2>
            <div id="myShifts" class="space-y-2">
                <p class="text-slate-400">注 砖专转...</p>
            </div>
        </section>

        <section class="bg-white p-6 rounded-3xl border shadow-sm">
            <h2 class="text-xl font-black mb-4 border-b pb-2 text-blue-800">注专/拽砖  拽</h2>
            <textarea id="sys-note" class="w-full p-4 rounded-xl border bg-slate-50 h-24 font-bold outline-none" placeholder="转 ..."></textarea>
            <button onclick="sendNote()" class="mt-4 px-6 py-2 bg-slate-800 text-white rounded-xl font-bold">砖 注专</button>
        </section>

        <button onclick="logout()" class="w-full py-3 text-red-500 font-bold border border-red-100 rounded-xl hover:bg-red-50">转转拽 注专转</button>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 px-8 py-4 rounded-2xl text-white font-black shadow-2xl transition-all opacity-0 translate-y-10 pointer-events-none"></div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxz7mg4b1xVkRI_4xVkCdfvt19YHuyUp3iIdW4Voh-1P5Se4DV2YbVLtp-EZkKVfTHR/exec";

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.backgroundColor = isError ? '#ef4444' : '#10b981';
            t.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-10'), 3000);
        }

        async function loadProfileData() {
            const prof = JSON.parse(localStorage.getItem('user_profile') || '{}');
            document.getElementById('up-name').value = prof.name || '';
            document.getElementById('up-phone').value = prof.phone || '';

            try {
                const r = await fetch(SCRIPT_URL);
                const db = await r.json();
                const myS = db.filter(x => x.砖_拽 === prof.name);
                
                const container = document.getElementById('myShifts');
                if(myS.length === 0) container.innerHTML = '<p class="text-slate-400"> 爪 砖专转 专砖转 注 砖.</p>';
                else {
                    container.innerHTML = myS.map(s => `
                        <div class="p-4 bg-blue-50 rounded-xl border border-blue-100 flex justify-between items-center">
                            <span class="font-bold text-blue-900">${s.住_砖专转} | ${s.转专}</span>
                            <span class="text-[10px] bg-blue-200 px-2 py-1 rounded-full">砖专</span>
                        </div>
                    `).join('');
                }
            } catch(e) { console.error(e); }
        }

        function updateDetails() {
            const name = document.getElementById('up-name').value;
            const phone = document.getElementById('up-phone').value;
            localStorage.setItem('user_profile', JSON.stringify({name, phone}));
            showToast("驻专 注 爪!");
        }

        async function sendNote() {
            const note = document.getElementById('sys-note').value;
            if(!note) return showToast(" 转 注专", true);
            const prof = JSON.parse(localStorage.getItem('user_profile') || '{}');
            
            await fetch(SCRIPT_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                body: JSON.stringify({ action: 'add', note, name: prof.name, phone: prof.phone, date: '注专转 注专转', shiftId: 'SYS' }) 
            });
            showToast("注专 砖 爪");
            document.getElementById('sys-note').value = "";
        }

        function logout() { localStorage.clear(); window.location.href = 'login.html'; }
        
        loadProfileData();
    </script>
</body>
</html>
