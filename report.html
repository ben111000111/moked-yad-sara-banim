<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×“×•"×— ×©×‘×•×¢×™ | ××•×§×“ ×”××•×§×“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #fff; }
        @media print {
            .no-print { display: none; }
            body { background-color: white; }
            .report-card { border: 1px solid #e2e8f0; break-inside: avoid; }
        }
    </style>
</head>
<body class="p-4 md:p-8 text-right">

    <header class="max-w-4xl mx-auto flex justify-between items-center mb-10 no-print border-b pb-4">
        <div>
            <h1 class="text-2xl font-black text-slate-800 italic">×¡×™×›×•× ×©×™×‘×•×¦×™× ×©×‘×•×¢×™</h1>
            <p class="text-slate-500 font-bold text-sm">×”×¤×¦×ª ×¡×™×“×•×¨ ×¢×‘×•×“×” ×œ××•×§×“× ×™×</p>
        </div>
        <div class="flex gap-2">
            <button onclick="shareWhatsApp()" class="px-4 py-2 bg-green-600 text-white rounded-xl font-bold text-xs shadow-lg hover:bg-green-700 transition-all flex items-center gap-2">
                <span>ğŸ’¬</span> ×©×™×ª×•×£ ×‘×•×•××˜×¡××¤
            </button>
            <button onclick="window.print()" class="px-4 py-2 bg-slate-800 text-white rounded-xl font-bold text-xs shadow-lg hover:bg-slate-900 transition-all flex items-center gap-2">
                <span>ğŸ–¨ï¸</span> ×”×“×¤×¡×”
            </button>
            <a href="admin.html" class="px-4 py-2 bg-slate-100 text-slate-600 rounded-xl font-bold text-xs">×—×–×¨×” ×œ× ×™×”×•×œ</a>
        </div>
    </header>

    <main id="reportContent" class="max-w-4xl mx-auto space-y-6">
        <div class="text-center py-20 opacity-30 font-bold animate-pulse">××¤×™×§ ×“×•"×— × ×ª×•× ×™×...</div>
    </main>

    <script src="config.js"></script>
    <script>
        let weeklyData = [];

        async function initReport() {
            try {
                const res = await fetch(CONFIG.SCRIPT_URL);
                const db = await res.json();
                
                // ×—×™×©×•×‘ ×ª××¨×™×›×™ ×”×©×‘×•×¢ ×”× ×•×›×—×™
                let now = new Date();
                let sun = new Date(now); sun.setDate(now.getDate() - now.getDay());
                let dates = [];
                for(let i=-1; i<6; i++) { // ××•×¦"×© ×¢×“ ×—××™×©×™
                    let d = new Date(sun); d.setDate(sun.getDate() + i);
                    dates.push(d.toISOString().split('T')[0]);
                }

                weeklyData = db.filter(s => dates.includes(s.×ª××¨×™×š));
                renderReport(dates);
            } catch (e) {
                console.error(e);
            }
        }

        function renderReport(dates) {
            const container = document.getElementById('reportContent');
            const DAYS = ['××•×¦"×©', '×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™'];
            
            let html = `<div class="bg-blue-600 p-6 rounded-3xl text-white mb-8 text-center shadow-xl">
                            <div class="text-3xl font-black italic">×¡×™×“×•×¨ ×¢×‘×•×“×” ×©×‘×•×¢×™</div>
                            <div class="font-bold opacity-80 mt-1 uppercase tracking-widest text-xs">××•×§×“ ×”××•×§×“ - ×™×“ ×©×¨×”</div>
                        </div>`;

            dates.forEach((date, i) => {
                const shifts = weeklyData.filter(s => s.×ª××¨×™×š === date);
                const hebDate = new Date(date).toLocaleDateString('he-IL');
                
                html += `
                    <div class="report-card bg-white p-6 rounded-[2rem] border-2 border-slate-50 mb-4">
                        <div class="flex justify-between items-center border-b pb-3 mb-4">
                            <span class="text-xl font-black text-slate-800">${DAYS[i]} <small class="text-xs text-slate-400 font-normal mr-2">${hebDate}</small></span>
                            <span class="text-[10px] font-bold text-blue-600 uppercase bg-blue-50 px-3 py-1 rounded-full">${PARASHOT_DB[date] || ''}</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${renderShiftType(shifts, 'morn', '×‘×•×§×¨')}
                            ${renderShiftType(shifts, 'eve', '×¢×¨×‘')}
                            ${renderShiftType(shifts, 'night', '×œ×™×œ×”')}
                        </div>
                    </div>`;
            });

            container.innerHTML = html;
        }

        function renderShiftType(shifts, type, label) {
            const s = shifts.find(x => x.×¡×•×’_××©××¨×ª.includes(type));
            return `
                <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                    <div class="text-[9px] font-black text-slate-400 uppercase mb-1">${label}</div>
                    <div class="font-bold text-slate-700">${s ? s.×©×_××•×§×“×Ÿ : '<span class="text-red-300 italic">- ××™×Ÿ ×©×™×‘×•×¥ -</span>'}</div>
                </div>`;
        }

        function shareWhatsApp() {
            const DAYS = ['××•×¦"×©', '×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™'];
            let text = "*×¡×™×“×•×¨ ×¢×‘×•×“×” ×©×‘×•×¢×™ - ××•×§×“ ×”××•×§×“*%0A---------------------------%0A";
            
            // ×œ×•×’×™×§×” ×œ×™×¦×™×¨×ª ×”×•×“×¢×ª ×˜×§×¡×˜
            container = document.getElementById('reportContent');
            // (×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£ ×œ×•×’×™×§×ª ××¢×‘×¨ ×¢×œ weeklyData)
            text += "×œ×¦×¤×™×™×” ×‘×¡×™×“×•×¨ ×”××œ× ×•×”×¢×“×›×Ÿ ×œ×—×¦×• ×›××Ÿ: " + window.location.href.replace('report.html', 'index.html');
            
            window.open(`https://wa.me/?text=${text}`);
        }

        initReport();
    </script>
</body>
</html>
